<!doctype html>


<main class="card">
<div id="carousel">
<div id="slides"></div>
</div>


<div id="infoBar">
<span class="info-item" id="dateFixed"></span>
<span class="info-item" id="authorFixed"></span>
</div>


<div class="nav">
<button class="nav-btn" id="prevBtn">‚óÄ</button>
<div class="nav-icon">‚ú¶</div>
<button class="nav-btn" id="nextBtn">‚ñ∂</button>
</div>


<div id="animArea">üë§‚úçÔ∏è Sto scrivendo‚Ä¶</div>


<div class="hint">Scorri tra i messaggi ‚úåÔ∏è</div>
<footer>Modifica o aggiungi file <code>message1.txt, message2.txt...</code> su GitHub.</footer>
</main>


<script>
async function loadMessages(){
const slides = document.getElementById('slides');
const msgs = [];
let index = 0;
let found = true;


while(found){
try{
const res = await fetch(`message${index}.txt`, {cache:'no-store'});
if(!res.ok){found = false;break;}


let text = (await res.text()).trim();
const lm = res.headers.get('last-modified');
let autore = null;


if(text.startsWith('@autore:')){
const firstLineEnd = text.indexOf('\n');
autore = text.substring(9, firstLineEnd).trim();
text = text.substring(firstLineEnd+1).trim();
}


msgs.push({text,lm,autore});
index++;
}catch(e){found=false;}
}


if(msgs.length===0){
slides.innerHTML='<div class="slide">Nessun messaggio trovato</div>';
return;
}


msgs.forEach(m=>{
const div=document.createElement('div');
div.className='slide';
div.textContent=m.text;
slides.appendChild(div);
});


return msgs;
}


let current=0;
let allMsgs=[];


function updateCarousel(){
const slides=document.getElementById('slides');
slides.style.transform=`translateX(${-current*100}%)`;
updateInfoBar();
triggerAnimation();
}


function updateInfoBar(){
const dateBox=document.getElementById('dateFixed');
const authorBox=document.getElementById('authorFixed');
const m=allMsgs[current];


// DATE
if(m && m.lm){
const d=new Date(m.lm);
dateBox.textContent = !isNaN(d) ? `üìÖ ${d.toLocaleString()}` : '';
} else dateBox.textContent='';


// AUTHOR
if(m && m.autore){
authorBox.textContent = `üë§ ${m.autore}`;
} else authorBox.textContent='üë§ ‚Äî';
}


function triggerAnimation(){
const a=document.getElementById('animArea');
a.style.opacity=0;
setTimeout(()=>{
a.textContent='üë§‚úçÔ∏è Messaggio #' + (current+1);
a.style.opacity=1;
},150);
}


document.getElementById('prevBtn').onclick=()=>{
current=Math.max(0,current-1);
updateCarousel();
};
document.getElementById('nextBtn').onclick=()=>{
current=Math.min(allMsgs.length-1,current+1);
updateCarousel();
};


loadMessages().then(msgs=>{
allMsgs=msgs||[];
updateCarousel();
});
</script>
</body>
</html>
