<!doctype html>
footer{margin-top:1.5rem;font-size:0.85rem;opacity:0.7}
</style>
</head>
<body>
<div style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; border:10px solid #9ca3ff; box-sizing:border-box; border-radius:20px; z-index:9999;"></div>


<main class="card">
<div id="carousel">
<div id="slides"></div>
</div>
<div id="infoBar"></div>


<div class="nav">
<button class="nav-btn" id="prevBtn">â—€</button>
<div class="nav-icon">âœ¦</div>
<button class="nav-btn" id="nextBtn">â–¶</button>
</div>


<div id="animArea">ğŸ‘¤âœï¸ Sto scrivendoâ€¦</div>


<div class="hint">Scorri tra i messaggi âœŒï¸</div>
<footer>Modifica o aggiungi file <code>message1.txt, message2.txt...</code> su GitHub.</footer>
</main>


<script>
async function loadMessages(){
const slides = document.getElementById('slides');
const msgs = [];
let index = 1;
let found = true;


while(found){
try{
const res = await fetch(`message${index}.txt`, {cache:'no-store'});
if(!res.ok){found = false;break;}


let raw = (await res.text()).trim();
const lm = res.headers.get('last-modified');
let autore = 'â€”';
if(raw.startsWith('@autore:')){
const firstLineEnd = raw.indexOf('\n');
autore = raw.substring(9, firstLineEnd).trim();
raw = raw.substring(firstLineEnd).trim();
}
msgs.push({text: raw, lm, autore});
index++;
}catch(e){found=false;}
}


if(msgs.length===0){
slides.innerHTML='<div class="slide">Nessun messaggio trovato</div>';
return;
}


msgs.forEach(m=>{
const div=document.createElement('div');
div.className='slide';
div.textContent=m.text;
slides.appendChild(div);
});


return msgs;
}


let current=0;
let allMsgs=[];


function updateCarousel(){
const slides=document.getElementById('slides');
slides.style.transform=`translateX(${-current*100}%)`;
updateInfoBar();
triggerAnimation();
}


function updateInfoBar(){
const bar=document.getElementById('infoBar');
const m=allMsgs[current];
if(!m){bar.textContent='';return;}
let dateStr='';
if(m.lm){const d=new Date(m.lm);if(!isNaN(d)) dateStr=d.toLocaleString();}
let autoreStr = m.autore || 'â€”';
bar.innerHTML = `ğŸ“… ${dateStr} &nbsp;&nbsp;|&nbsp;&nbsp; ğŸ‘¤ ${autoreStr}`;
}


function triggerAnimation(){
const a=document.getElementById('animArea');
a.style.opacity=0;
setTimeout(()=>{
a.textContent='ğŸ‘¤âœï¸ Messaggio #' + (current+1);
a.style.opacity=1;
},150);
}


document.getElementById('prevBtn').onclick=()=>{current=Math.max(0,current-1);updateCarousel();};
document.getElementById('nextBtn').onclick=()=>{current=Math.min(allMsgs.length-1,current+1);updateCarousel();};


loadMessages().then(msgs=>{allMsgs=msgs||[];updateCarousel();});
</script>
</body>
</html>
