<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shsh ‚Äî Messaggi</title>
<style>
:root{--bg:#0f172a;--card:#0b1220;--accent:#9ca3ff}
html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
body{display:grid;place-items:center;background:linear-gradient(180deg,#071032, #0f172a);color:#e6eef8}
.card{width:min(92vw,720px);padding:3rem;border-radius:18px;background:rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.6);text-align:center;position:relative}
#carousel{overflow:hidden;}
.slide{min-width:100%;transition:transform 0.4s ease;font-size:clamp(20px,6vw,48px);line-height:1.1;margin-bottom:1rem}
#slides{display:flex;}
/* barra data + autore */
#infoBar{
  font-size:0.9rem;
  opacity:0.85;
  margin:0.5rem 0 1rem;
  display:flex;
  justify-content:center;
  gap:1.2rem;
}
.nav{margin-top:1rem;display:flex;justify-content:center;align-items:center;gap:1rem}
.nav-btn{
  cursor:pointer;
  background:rgba(255,255,255,0.06);
  border:none;
  padding:0.6rem 1rem;
  border-radius:8px;
  color:#e6eef8;
  font-size:1rem;
}
.nav-icon{font-size:1.4rem;opacity:0.8}

#goLastBtn{
  margin-top:1rem;
  cursor:pointer;
  background:rgba(255,255,255,0.08);
  border:1px solid #9ca3ff;
  padding:0.6rem 1.2rem;
  border-radius:10px;
  color:#e6eef8;
  font-size:0.9rem;
}

#animArea{
  margin-top:2rem;
  min-height:80px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:1.2rem;
  opacity:0;
  transition:opacity 0.8s ease;
}
.hint{margin-top:1rem;font-size:0.85rem;color:var(--accent)}
footer{margin-top:1.5rem;font-size:0.85rem;opacity:0.7}
</style>
</head>
<body>
<div style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; border:10px solid #9ca3ff; box-sizing:border-box; border-radius:20px; z-index:9999;"></div>

<main class="card">
  <div id="carousel">
    <div id="slides"></div>
  </div>

  <!-- data + autore -->
  <div id="infoBar"></div>

  <div class="nav">
    <button class="nav-btn" id="prevBtn">‚óÄ</button>
    <div class="nav-icon">‚ú¶</div>
    <button class="nav-btn" id="nextBtn">‚ñ∂</button>
  </div>

  <!-- PULSANTE VAI ALL‚ÄôULTIMO -->
  <button id="goLastBtn">‚è≠ </button>

  <div id="animArea">üë§‚úçÔ∏è Sto scrivendo‚Ä¶</div>

  <div class="hint">Scorri tra i messaggi ‚úåÔ∏è</div>
  <footer>Modifica o aggiungi file <code>message1.txt, message2.txt...</code> (e opzionalmente <code>author1.txt, author2.txt...</code>) su GitHub.</footer>
</main>

<script>
async function loadMessages(){
  const slides = document.getElementById('slides');
  const msgs = [];
  let index = 1;
  let found = true;

  while(found){
    try{
      const res = await fetch(`message${index}.txt`, {cache:'no-store'});
      if(!res.ok){ found = false; break; }

      const text = (await res.text()).trim();
      const lm = res.headers.get('last-modified');

      // autore da authorN.txt
      let autore = null;
      try{
        const aRes = await fetch(`author${index}.txt`, {cache:'no-store'});
        if(aRes.ok){
          autore = (await aRes.text()).trim();
        }
      }catch(e){}

      msgs.push({text, lm, autore});
      index++;
    }catch(e){
      found = false;
    }
  }

  if(msgs.length === 0){
    slides.innerHTML = '<div class="slide">Nessun messaggio trovato</div>';
    return [];
  }

  msgs.forEach(m => {
    const div = document.createElement('div');
    div.className = 'slide';
    div.textContent = m.text;
    slides.appendChild(div);
  });

  return msgs;
}

let current = 0;
let allMsgs = [];

function updateCarousel(){
  const slides = document.getElementById('slides');
  slides.style.transform = `translateX(${-current*100}%)`;
  updateInfoBar();
  triggerAnimation();
}

function updateInfoBar(){
  const bar = document.getElementById('infoBar');
  const m = allMsgs[current];
  if(!m){ bar.textContent = ''; return; }

  let dateStr = '';
  if(m.lm){
    const d = new Date(m.lm);
    if(!isNaN(d)) dateStr = d.toLocaleString();
  }

  const autoreStr = m.autore && m.autore.length > 0 ? m.autore : '‚Äî';

  bar.innerHTML = `üìÖ ${dateStr} &nbsp;&nbsp;|&nbsp;&nbsp; üë§ ${autoreStr}`;
}

function triggerAnimation(){
  const a = document.getElementById('animArea');
  a.style.opacity = 0;
  setTimeout(()=>{
    const numero = current + 1;
    a.textContent = 'üë§‚úçÔ∏è Messaggio #' + numero;
    a.style.opacity = 1;
  },150);
}

document.getElementById('prevBtn').onclick = () => {
  current = Math.min(allMsgs.length - 1, current + 1);
  updateCarousel();
};

// ‚ñ∂ deve andare verso i PI√ô VECCHI ‚Üí quindi -1
document.getElementById('nextBtn').onclick = () => {
  current = Math.max(0, current - 1);
  updateCarousel();
};

document.getElementById('goLastBtn').onclick = () => {
  current = 0;   // primo messaggio pubblicato (#1)
  updateCarousel();
};

loadMessages().then(msgs => {
  allMsgs = msgs || [];
  if(allMsgs.length === 0) return;

  // PARTI DALL'ULTIMO MESSAGGIO
current = allMsgs.length - 1;

  updateCarousel();
});
</script>
</body>
</html>


